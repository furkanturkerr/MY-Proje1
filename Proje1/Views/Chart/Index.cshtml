@{
ViewData["Title"] = "Kategori Grafiği";
Layout = "_adminlayouts";
}

<h2>Kategori - Stok Grafiği</h2>

<!-- Google Charts kütüphanesi -->
<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
<!-- jQuery -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<!-- Grafik alanı -->
<div id="Piechart_div" style="width:900px; height:500px;"></div>

<script type="text/javascript">
    // Google Charts yükle
    google.charts.load('current', { packages: ['corechart'] });
    google.charts.setOnLoadCallback(loadData);

    function loadData() {
        $.ajax({
            type: "GET",
            url: "/Chart/CategoryChart", // Controller'daki JSON endpoint
            dataType: "json",
            success: function (result) {
                drawChart(result);
            },
            error: function (err) {
                console.error("Veri çekilemedi:", err);
            }
        });
    }

    function drawChart(result) {
        var data = new google.visualization.DataTable();
        data.addColumn('string', 'CategoryName');
        data.addColumn('number', 'CategoryCaunt');

        var dataArray = [];
        $.each(result, function (i, obj) {
            dataArray.push([obj.categoryName, obj.categoryCaunt]); // küçük harf dikkat!
        });
        data.addRows(dataArray);

        var options = {
            title: "Kategori - Stok Grafiği",
            width: 900,
            height: 500,
            is3D: true,
            legend: { position: 'right', textStyle: { fontSize: 14 } },
            chartArea: { left: 50, top: 50, width: '80%', height: '75%' },
        };

        var chart = new google.visualization.PieChart(document.getElementById('Piechart_div'));
        chart.draw(data, options);
    }
</script>
